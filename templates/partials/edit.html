{% include "partials/_search_bar.html" %}

{% raw %}

<div id="confirmDeleteDraftDialog" data-ng-show="confirmDeleteDraft" class="popover show">
  <div class="popover-inner">
    <button class="close" data-ng-click="confirmDeleteDraft.abort()">&times;</button></h3>
</div>

<div class="popover-content">
  <h4>Vill du verkligen ta bort utkastet?</h4>
  <button class="btn btn-success" data-ng-click="confirmDeleteDraft.execute()">Ja</button></h3>
<button class="btn btn-warning" data-ng-click="confirmDeleteDraft.abort()">Nej</button></h3>
  </div>
</div>

<div class="content bib" id="prelude"><form name="form" id="record" class="form-horizontal">
  <div id="grid"></div>
    <!--<div data-ng-view></div>-->
  <header>
    <h1>Bibliografisk post</h1>
    <div class="levels">
      <span>{{ enums.bibLevel[record.bibLevel].label_sv }}</span>
      <span>{{ enums.encLevel[record.encLevel].label_sv }}</span>
      <span>{{ enums.catForm[record.catForm].label_sv }}</span>
    </div>
    <div class="modes">
      <a href="#" class="active">LIBRIS</a>
      <a href="/jsonld{{ record['@id'] }}">JSON-LD</a>
      <a href="#" class="beta-blocker">MARC</a>
    </div>
  </header>

  <section id="instance" name="instance" data-ng-repeat="instance in [record.about]">
    <ng-form name="subform">
    <h2 data-ng-click="cycleType($event, instance)"> <span>{{ getTypeDef(instance).label_sv }}</span><i></i></h2>
    <div class="cols">
      <div class="col6" data-ng-init="title = instance.title">
        <label>
          <textarea data-inplace class="title" data-ui-jq="autosize" spellcheck="false" placeholder="Huvudtitel" data-ng-model="title.titleValue"></textarea>
          <span class="lbl">{{ "Huvudtitel" }}</span>
        </label>
        <label>
          <textarea data-inplace data-ui-jq="autosize" spellcheck="false" placeholder="Övrig titelinformation" data-ng-model="title.subtitle">{{ title.subtitle }}</textarea>
          <span class="lbl">{{ "Övrig titelinformation" }}</span>
        </label>
      </div>
      <div class="col6">
        <label class="error">
          <textarea data-inplace data-ui-jq="autosize" spellcheck="false" data-ng-model="instance.responsibilityStatement" placeholder="Upphov"></textarea>
          <span class="lbl">{{ "Upphov" }}</span>
        </label>
      </div>
    </div>

    <h3>Verk</h3>
    <div class="cols" data-ng-init="work = record.about.instanceOf">
      <div class="col5">
        <label class="ng-binding">
          <!--<span class="fakeholder" data-fakeholder>Välj ett land</span>
          <select class="selectpicker" data-selectpicker data-ng-model="work.language" data-ng-options="code as name for (code, name) in langlist">
          </select>-->
          <!--<select class="selectpicker" data-placeholder="Välj ett språk" data-ui-select2 data-ng-model="work.language" style="width:75%">
             <option></option>
             <option data-ng-repeat="(code, name) in langlist" value="{{ code }}">{{ name }} ({{ code }})</option>
         </select>-->
              <!--<input data-inplace class="input" type="text" placeholder="Personnamn" data-kitin-autocomplete="field" data-kitin-template="auth-completion-template" data-ng-model="person.authoritativeName" />-->
              <input data-inplace class="input-large authdependant" type="text" placeholder="Språk" data-ng-model="work.language" data-kitin-autoselect="field" data-kitin-template="resource-list-template"/>
              <span class="lbl">{{ "Språk" }}</span>
         <!--<pre>Selected: {{ work.language | json }}</pre>
         <input data-inplace ui-select2="langlist" ng-model="work.language" style="width:200px" />-->
        </label>
      </div>
      <div class="col7">
        <div data-ng-show="work.creator"
             onload="subj = work; rel = 'creator'; person = work.creator"
             data-ng-include="'render-person'"></div>
        <button class="add-thing btn-link" data-ng-click="newObject(work, 'creator', 'Person')">{{ 'Huvuduppslag' }}
          <i data-ng-hide="work.creator" class="icon icon-plus-sign"></i></button>
        <hr />
        <div data-ng-repeat="person in work.contributorList"
             onload="subj = work; rel = 'contributorList'" data-ng-include="'render-person'"></div>
        <button class="add-thing btn-link" data-ng-click="addObject(work, 'contributorList', 'Person')">{{ 'Biuppslag' }} <i class="icon icon-plus-sign"></i></button>
      </div>
    </div>

    <script type="text/ng-template" id="render-person">
      <div class="entity person" data-ng-init="editable = !(person.controlledLabel || person.givenName)">
        <div class="col3" data-ng-hide="editable">
          <label data-ng-click="editable=!editable">
            <span data-ng-include="'render-person-name'"></span> &nbsp;</label>
        </div>
        <div class="addon" data-ng-show="editable">
          <label>
            <input data-inplace class="input-mini" type="text" placeholder="Egennamn" data-ng-model="person.givenName"
            	data-kitin-autocomplete="person" />
            <span class="lbl">{{ "Egennamn" }}</span>
          </label>
          <label>
            <input data-inplace class="input-mini" type="text" placeholder="Familjenamn" data-kitin-autocomplete="person" data-ng-model="person.familyName" />
            <span class="lbl">{{ "Familjenamn" }}</span>
          </label>
          </div>
        <div class="addon" data-ng-show="editable">
          <label>
            <input data-inplace class="input-mini authdependant" type="text" placeholder="ÅÅÅÅ" data-ng-model="person.birthYear" />
            <span class="lbl">{{ "Född" }}</span>
          </label>
          <label>
            <input data-inplace class="input-mini authdependant" type="text" placeholder="ÅÅÅÅ" data-ng-model="person.deathYear" />
            <span class="lbl">{{ "Död" }}</span>
          </label>
        </div>
        <div class="addon">
          <label>
            <span data-ng-repeat="role in personRoleMap[person['@id']]"><span data-ng-hide="$first">, </span>{{ role.label_sv }}</span>
          </label>
          <label data-ng-hide="editable">
            <button class="btn-link on-hover" data-ng-click="removeObject(subj, rel, $index)"><i class="icon icon-remove"></i></button>
          </label>
          <button class="btn-link" data-ng-show="editable" data-ng-click="editable=false"><i class="icon icon-ok"></i></button>
        </div>
      </div>
    </script>

    <h3>Utgivning och tillverkning</h3>
    <div class="cols">
      <div class="col6" data-ng-show="instance['@type'] != 'Book'">
        <label>
          <input data-inplace class="ng-pristine ng-valid" type="text" data-ng-model="instance.mediaTerm" placeholder="Allmän medieterm">
          <span class="lbl">{{ "Allmän medieterm" }}</span>
        </label>
      </div>
    </div>
    <div class="cols">
      <div class="col3">

        <div data-ng-repeat="identifier in instance.identifier" class="entity">
          <ng:switch on="identifier.identifierScheme">
            <div data-ng-switch-when="ISBN">
              <label>
                <input data-inplace name="isbn_name" type="text" data-ng-model="identifier.identifierValue" placeholder="{{ identifier.identifierScheme }}"
                      data-isbn-pattern="^$|^[0-9\-xX]*$" isbnvalidator/>
                <span class="lbl_inline lbl"
                      data-ng-hide="subform.isbn_name.$error.invalid_value || subform.isbn_name.$error.invalid_length">{{ "ISBN" }}</span>
                <span class="lbl_inline lbl error_label"
                      data-ng-show="subform.isbn_name.$error.invalid_value || subform.isbn_name.$error.invalid_length">{{ "ISBN" }}</span>
                <span class="error_message" data-ng-show="subform.isbn_name.$error.invalid_value">(Fel numeriskt värde)</span>
                <span class="error_message" data-ng-show="subform.isbn_name.$error.invalid_length">(Fel längd)</span>
                <!--<input data-inplace name="isbn_name" type="text" required="true" data-ng-model="instance.isbn" placeholder="ISBN" data-isbn-pattern="^[0-9\-xX]*$" isbnvalidator/>
                <span class="lbl_inline lbl" data-ng-hide="subform.isbn_name.$error.invalid_value">{{ "ISBN" }}</span>
                <span class="lbl_inline lbl error_label" data-ng-show="subform.isbn_name.$error.invalid_value">{{ "ISBN" }}</span>
                <span class="error_message" data-ng-show="subform.isbn_name.$error.invalid_value">(Fel numeriskt värde)</span>-->
                <!--<span class="error_message" data-ng-show="subform.isbn_name.$error.invalid_length">(Fel längd)</span>-->
                <button class="btn-link on-hover" data-ng-click="removeObject(instance, 'identifier', $index)"><i class="icon icon-remove"></i></button>
              </label>
              <label>
                <input data-inplace class="ng-pristine ng-valid" type="text" data-ng-model="identifier.identifierNote" placeholder="Notering">
                <span class="lbl">{{ "ISBN-notering" }}</span>
              </label>
            </div>
            <div data-ng-switch-default>
              <label>
                <input data-inplace type="text" data-ng-model="identifier.identifierValue" placeholder="{{ identifier.identifierScheme }}"/>
                <span class="lbl">{{ identifier.identifierScheme }}</span>
              </label>
              <label>
                <input data-inplace class="ng-pristine ng-valid" type="text" data-ng-model="identifier.identifierNote" placeholder="Notering">
                <span class="lbl">{{ "Notering" }}</span>
              </label>
            </div>
          </ng:switch>
        </div>
        <button class="add-thing btn-link" data-ng-click="addObject(instance, 'identifier', 'ISBN')">{{ 'Lägg till ISBN' }} <i class="icon icon-plus-sign"></i></button>
      </div>
      <div class="col2">
        <label>
          <input data-inplace class="input-medium ng-pristine ng-valid" type="text" data-ng-model="instance.editionStatement.edition" placeholder="Upplaga">
          <span class="lbl">{{ "Upplaga" }}</span>
        </label>
      </div>
      <div class="col7">
        <div data-ng-repeat="publication in instance.publication" class="entity">
          <label class="col2">
            <input data-inplace class="input-medium ng-pristine ng-valid" type="text" data-ng-model="publication.providerName" placeholder="Utgivare förlag">
            <span class="lbl">{{ "Utgivare/förlag" }}</span>
          </label>
          <label class="col2">
            <input data-inplace class="input-medium ng-pristine ng-valid" type="text" data-ng-model="publication.place.label" placeholder="Utgivningsort">
            <span class="lbl">{{ "Utgivningsplats" }}</span>
          </label>
          <!-- TODO: specify type of place?
          <label>
            <... data-placeholder="Välj ett land" data-ng-model="record.about.instanceOf.country" ... >
            <span class="lbl">{{ "Utgivningsland" }}</span>
          </label>
          -->
          <label class="col1">
            <input data-inplace class="input-small ng-pristine ng-valid" type="text" data-ng-model="publication.providerDate" placeholder="Utgivningsår">
            <span class="lbl">{{ "Utgivningsår" }}</span>
          </label>
          <label class="col1 last" data-ng-hide="editable">
            <button class="btn-link on-hover" data-ng-click="removeObject(instance, 'publication', $index)"><i class="icon icon-remove"></i></button>
        </div>
        <button class="add-thing btn-link" data-ng-click="addObject(instance, 'publication', 'ProviderEvent')">{{ 'Lägg till utgivning' }} <i class="icon icon-plus-sign"></i></button>
      </div>
      <div class="col8">
        <div data-ng-repeat="manufacture in instance.manufacture">
          <label>
            <input data-inplace class="input-medium authdependant" type="text" placeholder="Tryckort" data-ng-model="manufacture.place.label" />
            <!--
            <select data-placeholder="Välj ett land" data-ui-select2 data-ng-model="instance.placeOfManufacture.name" style="width:75%">
              <option></option>
              <option data-ng-repeat="(code, name) in countrylist" value="{{ code }}">{{ name }} ({{ code }})</option>
            </select>
            -->
            <span class="lbl">{{ "Tryckplats" }}</span>
          </label>
        </div>
      </div>
    </div>

    <div class="cols">
      <div class="col3" data-ng-show="getTypeDef(instance).term == 'Audiobook'">
        <label>
          <input data-inplace class="ng-pristine ng-valid" type="text" data-ng-model="instance.publisherNumber" placeholder="Utgivningsnummer">
          <span class="lbl">{{ "Utgivningsnummer" }}</span>
        </label>
      </div>
    </div>

    <!-- TODO: partially toggle digital details
    <div data-ng-show="getTypeDef(instance).subClassOf != 'DigitalResource'">
    -->
    <h3>Fysisk beskrivning</h3>
    <div class="cols">
      <div class="col3">
        <label class="ng-binding">
          <input data-inplace class="ng-pristine ng-valid" type="text" data-ng-model="instance.extent" placeholder="Omfång">
          <span class="lbl">{{ "Omfång" }}</span>
        </label>
      </div>
      <div class="col3">
        <label>
          <input data-inplace class="ng-pristine ng-valid" type="text" data-ng-model="instance.dimensions" placeholder="Mått">
          <span class="lbl">{{ "Mått" }}</span>
        </label>
      </div>
      <div class="col3">
        <label>
          <input data-inplace class="ng-pristine ng-valid" type="text" data-ng-model="instance.otherPhysicalDetails" placeholder="Fysiska detaljer">
          <span class="lbl">{{ "Fysiska detaljer" }}</span>
        </label>
      </div>
      <div class="col3">
        <label>
          <input data-inplace class="ng-pristine ng-valid" type="text" data-ng-model="instance.availability" placeholder="Pris">
          <span class="lbl">{{ "Pris" }}</span>
        </label>
      </div>
    </div>
    <div class="cols" data-ng-show="getTypeDef(instance).subClassOf == 'DigitalResource'">
      <div class="col3">
        <label>
          <input data-inplace class="ng-pristine ng-valid" type="text" data-ng-model="instance.fileType" placeholder="Filtyp">
          <span class="lbl">{{ "Filtyp" }}</span>
        </label>
      </div>
      <div class="col3">
        <label>
          <input data-inplace class="ng-pristine ng-valid" type="text" data-ng-model="instance.systemRequirements" placeholder="Systemkrav">
          <span class="lbl">{{ "Systemkrav" }}</span>
        </label>
      </div>
    </div>
  <h3>{{ "Anmärkningar" }}</h3>
    <div class="cols">
      <div class="col6">
        <label>
          <textarea data-inplace data-ui-jq="autosize" spellcheck="false" data-ng-model="instance.listOfContents" placeholder="Formaterad innehållsförteckning"></textarea>
          <span class="lbl">{{ "Formaterad innehållsförteckning" }}</span>
        </label>
      </div>
      <div class="col6" data-ng-show="getTypeDef(instance).term == 'Audiobook'">
        <label>
          <input data-inplace class="ng-pristine ng-valid" type="text" data-ng-model="instance.contributorNote" placeholder="Medverkande">
          <span class="lbl">{{ "Medverkande" }}</span>
        </label>
      </div>
    </div>
    <div class="cols">
      <div class="col6">
          <label>
          <input data-inplace class="ng-pristine ng-valid" type="text" data-ng-model="instance.note" placeholder="Allmän anmärkning">
          <span class="lbl">{{ "Allmän anmärkning" }}</span>
        </label>
      </div>
      <div class="col6"></div>
    </div>
    </ng-form>
  </section>

  <section id="subject classification">
    <div class="cols"
         data-ng-include="'/partials/edit_subject'" onload="work = record.about.instanceOf">
    </div>

    <h3>{{ "Anmärkningar" }}</h3>
    <div class="cols">
      <div class="col6">
        <label>
            <textarea data-inplace data-ui-jq="autosize" spellcheck="false"
                      data-ng-model="work.summary" placeholder="Sammanfattning"></textarea>
            <span class="lbl">{{ "Sammanfattning" }}</span>
        </label>
      </div>
    </div>
  </section> 
  
  <section class="submit modificationinfo" data-ng-class="modifiedClasses()">
<!--post beta:
    <span class="removedraft" data-ng-show="draft" data-ng-click="promptConfirmDelete($event, draft.type, draft.id)">
      <button class="btn-link" data-ng-click="somebutton.click()"><i class="icon icon-remove"></i> Ta bort utkast</button>
    </span>-->
    <button class="btn-link" id="draft" data-ng-click="saveDraft()"
      title="{{lastSavedLabel('Senast sparad: %s')}}">Spara utkast</button>
    <button class="btn btn-dark btn-submit" id="publish" data-ng-disabled="form.$invalid" data-ng-click="save()"
      title="{{lastPublishedLabel('Senast publicerad: %s')}}">Publicera</button>
    <p class="message" data-ng-show="modifications.message">{{ modifications.message }}</p>
  </section>
</form></div>

<div class="content holdings" id="prelude">
  <div id="grid"></div>
    <!--<div data-ng-view></div>-->
  <header>
    <h1>Bestånd</h1>
  </header>
<!--remove when holdings are done
  <section id="holdings">
    <div class="cols holdings-editor">
      <div class="col3 holdings-list">
        <ul>
          <li><a href="#">A</a></li>
          <li class="active"><a href="#">B</a></li>
          <li><a href="#">C</a></li>
        </ul>
      </div>
      <div class="col9">
        <div class="editor">
        <h3>{{ "Förslag på signum" }}</h3>
          <div class="suggestion-classification">
          <ul>
            <li data-ng-repeat="holding in holdings" data-ng-show="holding.classificationPart"><i class="icon icon-circle-arrow-up"></i> {{ holding.classificationPart }}</li>
          </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="foot">
      <button class="btn btn-purple">Lägg till <i class="icon icon-white icon-chevron-down"></i></button>
    </div>
  </section>-->
  <section class="holdings">
    <h2>Bestånd<i></i></h2>
    <h3 class="inline_heading">{{userSigel}}</h3>
    <div class="cols">
      <div class="col6">


        <div class="alert alert-block">
    Bestånd tillfälligt avaktiverat.
    </div>


<!--        <label>
          <input data-inplace type="text" placeholder="Avdelning/Samling" data-ng-model="holding.shelvingLocation"/>
          <span class="lbl">{{ "Avdelning/Samling" }}</span>
        </label>
        <label>
          <input data-inplace type="text" placeholder="Hyllsignum/Klassifikation" data-ng-model="holding.classificationPart"/>
          <span class="lbl">{{ "Hyllsignum/Klassifikation" }}</span>
        </label>-->
        
        <!-- post beta:
        <div class="suggestion-classification">
          <ul>
            <li data-ng-repeat="holding in holdings" data-ng-show="holding.classificationPart"><i class="icon icon-circle-arrow-up"></i> {{ holding.classificationPart }}</li>
          </ul>
          <span class="lbl lbl-suggest">Förslag på signum</span>
        </div>
        -->
       </div>
<!--     <div class="col6">
          <label>
          <input data-inplace type="text" placeholder="Löpnummer" data-ng-model="holding.shelvingControlNumber"/>
          <span class="lbl">{{ "Löpnummer" }}</span>
          </label>
          <label>
          <input data-inplace type="text" placeholder="Uppställningsord" data-ng-model="holding.shelvingFormOrTitle"/>
          <span class="lbl">{{ "Uppställningsord" }}</span>
          </label>
          <label>
          <input data-inplace type="text" placeholder="Exemplarinfo" data-ng-model="holding.itemPart"/>
          <span class="lbl">{{ "Exemplarinfo" }}</span>
          </label>
          <label>
          <input data-inplace type="text" placeholder="Exemplarnummer" data-ng-model="holding.copyNumber"/>
          <span class="lbl">{{ "Exemplarnummer" }}</span>
          </label>
          <label>
          <textarea data-inplace data-ui-jq="autosize" spellcheck="false" placeholder="Publik anmärkning" data-ng-model="holding.shelvingPublicNote"></textarea>
          <span class="lbl">{{ "Publik anmärkning" }}</span>
          </label>
          <label>
          <textarea data-inplace data-ui-jq="autosize" spellcheck="false" placeholder="Intern anmärkning" data-ng-model="holding.shelvingNonpublicNote"></textarea>
          <span class="lbl">{{ "Intern anmärkning" }}</span>
          </label>
      </div>-->
    </div>
    <div class="foot">
      <!--not available in beta:<button disabled class="btn btn-purple" data-ng-click="addHolding(holdings)">Lägg till <i class="icon icon-white icon-chevron-down"></i></button>-->
    </div>
    </section>
    <section class="submit">
<!--       <button class="btn btn-purple  btn-submit" id="save-hld" data-ng-click="saveHolding(holding)">Spara bestånd</button> -->
      <!-- post beta:
      <button data-ng-show="holding['@id']"class="btn-link" id="delete-hld" data-ng-click="deleteHolding(holding['@id'])">Ta bort</button>
      -->
    </section>
<!--
  <section class="holdings holdings-list">
    <h2>Allt Bestånd<i></i></h2>
    <div class="cols">
      <div class="col12">
          <div data-ng-repeat="holding in holdings" data-ng-include="'render-holding'">
          </div>
     </div>
    </div>
    </section>
-->
  </div>
</div>
</form>

<script type="text/ng-template" id="render-holding">
<div class="holdings-list" data-ng-show="holding.location"> 
  <ul>
    <li data-ng-show="holding.location"><a href="#" class="sigel beta-blocker">{{ holding.location }}<span class="pull-right"><!--<i class="icon icon-black icon-chevron-down"></i></span>--></a></li>
  </ul>
</div>
</script>

<script type="text/html" id="resource-list-template">
<div class="auth">
    <h4>
    <span class="name"><%= name %></span><span class="date"> <%= code %></span>
    </h4>
</div>
</script>

<script type="text/html" id="auth-completion-template">
<div class="auth">
  <h4>
    <span class="name"><%= data['controlledLabel'] %></span>
    <% if (data['authorized']) { %>
      <span class="what"><i class="icon icon-bookmark"></i>Aukt.</span>
    <% } %>
  </h4>
  <% if (data['hasAnnotation'] && data['hasAnnotation']['about']) { %>
    <ul class="about">
      <% if (Object.prototype.toString.call(data['hasAnnotation']['about']) === '[object Array]') { %> 
        <% data['hasAnnotation']['about'].forEach(function(item) { %>
          <li><%= item %></li>
        <% }); %>
      <% } else { %>
        <li><%= data['hasAnnotation']['about'] %></li>
      <% } %>
    </ul>
  <% } %>
</div>
</script>

{% endraw %}
