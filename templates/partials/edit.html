<div id="confirmDeleteDraftDialog" data-ng-show="confirmDeleteDraft" class="popover show">
  <div class="popover-inner">
    <button class="close" data-ng-click="confirmDeleteDraft.abort()">&times;</button></h3>
</div>

<div class="popover-content">
  <h4>Vill du verkligen ta bort utkastet?</h4>
  <button class="btn btn-success" data-ng-click="confirmDeleteDraft.execute()">Ja</button></h3>
<button class="btn btn-warning" data-ng-click="confirmDeleteDraft.abort()">Nej</button></h3>
  </div>
</div>

<div data-ng-show="draft" data-ng-click="promptConfirmDelete($event, draft.type, draft.id)">
  <div class="popover-inner">
    <button class="close" data-ng-click="somebutton.click()">Ta bort utkast</button>
  </div>
</div>

<form id="record" class="form-horizontal">
  <div data-ng-repeat="work in [record.about.instanceOf]">
  <label>
    <textarea class="title" spellcheck="false" placeholder="Skriv en titel" data-ng-model="work.title">Att bryta ny marc</textarea>
    <span class="lbl">Huvudtitel</span>
  </label>
</div>
  <h1>BIBLIOGRAFISK POST</h1>
  <article class="well">
  <!-- TODO: when value is object (e.g. @id, code and label):
      - link! don't use label in editable data directly
      - E.g. (needs onchange to set label in object?):
        <select data-ng-options="key as val.label_sv for (key, val) in meta.encLevels"
          data-ng-model="record.encLevel.code"></select>
    -->
    <section id="prelude">
      <div class="row-fluid">
        <div class="field span2">
          {{ record.about['@type'].join(", ") }}
        </div>
        <div class="field span2">
          {{ record.about.instanceOf['@type'].join(", ") }}
        </div>
        <div class="field span3">
          <select>
            <option value="record.encLevel.code">{{ record.encLevel.label }}</option>
          </select>
        </div>
        <div class="field span3">
          <input class="input" type="text" data-ng-model="record.catForm.label" />
          <label>{{ "Katalogiseringsregler" }}</label>
        </div>
        <div class="field span1">
          <input class="input-mini" type="text" data-ng-model="record.creator.abbr" />
          <label>{{ "Bibliografi" }}</label>
        </div>
      </div>
    </section>

    <button type="button" class="btn btn-mini" data-toggle="collapse" data-target="#record-hidden">Fler detaljer</button>
    <section id="record-hidden" class="collapse out">
      <h2>POSTINFORMATION</h2>
      <div class="row-fluid">
        <div class="field span6">
          <table class="table table-condensed">
            <tbody>
            <tr>
              <td>{{ "Status" }}</td>
              <td>{{ record.status.label }}</td>
            </tr>
            <tr>
              <td>{{ "Bibid" }}</td>
              <td>{{ record.controlNumber }}</td>
            </tr>
            <tr>
              <td>{{ "LIBRISIII-nummer" }}</td>
              <td>{{ record.localSystemNumber }}</td>
            </tr>
            <tr>
              <td>{{ "LC-nummer" }}</td>
              <td>{{ record.lccn }}</td>
            </tr>
            <tr>
              <td>{{ "Datum för senaste ändring" }}</td>
              <td>{{ record.dateAndTimeOfLatestTransaction }}</td>
            </tr>
            <tr>
              <td>{{ "Katalogiserande instans" }}</td>
              <td>{{ record.creator['abbr'] }}</td>
            </tr>
            <tr>
              <td>{{ "Intern anmärkning" }}</td>
              <td>{{ record.internalRemark }}</td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="field span6">
          Ändrad av:
          <ul>
            <li data-ng-repeat="location in record.catalogingChangesBy">{{ location['abbr'] }}</li>
          </ul>
        </div>
      </div>
    </section>


    <hr/>
    <section id="work" data-ng-repeat="work in [record.about.instanceOf]">
      <h2>VERK</h2>
      <div class="row-fluid">
        <div class="field span8">
          <input class="title input-xxlarge" type="text" data-ng-model="work.title" />
          <label>{{ "Huvudtitel" }}</label>
          <input class="title input-xxlarge" type="text" data-ng-model="work.titleRemainder" />
          <label>{{ "Övrigt titelinformation" }}</label>
          <input class="input-xxlarge" type="text" data-ng-model="work.mediaTerm" />
          <label>{{ "Allmän mediaterm" }}</label>
        </div>
        <div class="field span4">
          <input class="input-large" type="text" data-ng-model="work.statementOfResponsibility" />
          <label>{{ "Upphov" }}</label>
        </div>
      </div>

      <div class="row-fluid persons">
        <div class="field span6 person" data-ng-repeat="person in work.authorList">
          <div class="row-fluid">
            <div class="field span7">
              <i class="icon-user icon-author"></i>
              <input class="input" type="text" data-kitin-autocomplete="field" data-kitin-template="auth-completion-template" data-ng-model="person.authoritativeName" />
              <label>{{ "Personnamn" }}</label>
            </div>
            <div class="field span2">
              <input class="input-mini authdependant" type="text" data-ng-model="person.birthYear" />
              <label>{{ "Född" }}</label>
            </div>
            <div class="field span2">
              <input class="input-mini authdependant" type="text" data-ng-model="person.deathYear" />
              <label> &mdash; {{ "Död" }}</label>
            </div>
          </div>
          <input type='button' value='-' class="btn btn-mini" data-ng-click="remove_person($index)"/>
        </div>
      </div>
        <input type='button' value='+' class="btn btn-mini" data-ng-click="add_person(work.authorList)"/>

      <h3>{{ "Språk" }}</h3>
      <div class="row-fluid">
        <div class="field span12">
        <select data-ng-options="code as name for (code, name) in langlist" data-ng-model="work.language"></select><br />
        </div>
      </div>

      <h3>{{ "Ämnen" }}</h3>
      <div class="row-fluid" >
        <div class="field span12">
          <ul class="inline">
            <li data-ng-repeat="topic in work.subject"><a class="btn btn-small" href="{{ topic['@id'] }}"><i class="icon-tag"></i> {{ topic['@id'] }}</a></li>
          </ul>
          <ul class="inline">
            <li data-ng-repeat="topicalTerm in record.topicalTerm"><a class="btn btn-small" href="{{ topicalTerm }}"><i class="icon-tag"></i> {{ topicalTerm }}</a></li>
          </ul>
        </div>
      </div>
    </section>

    <hr/>
    <section id="instance" data-ng-repeat="instance in [record.about]">
      <h2>INSTANS</h2>
      <h3>{{ "Utgivning" }}</h3>
      <div class="row-fluid">
        <div class="field span6">
          <input class="input" type="text" data-ng-model="instance.isbn" isbnvalidator />
          <input class="input-mini" type="text" data-ng-model="instance.isbnNote" />
          <label>{{ "ISBN" }}</label>
        </div>
        <div class="field span6">
          <input class="input-xlarge" type="text" data-ng-model="instance.publisher.name" />
          <label>{{ "Utgivare/förlag" }}</label>
        </div>
      </div>
      <div class="row-fluid">
        <div class="field span3">
          <input class="input-small" type="text" data-ng-switch-on="instance.pubDate['@value']" data-ng-model="instance.pubDate['@value']" />
          <label>{{ "Utgivningsdatum" }}</label>
        </div>
        <div class="field span3">
          <input class="input-small" type="text" data-ng-model="instance.edition" />
          <label>{{ "Upplaga" }}</label>
        </div>
        <div class="field span6">
          <input class="input" type="text" data-ng-model="instance.placeOfPublication.label" />
          <label>{{ "Utgivningsort" }}</label>
        </div>
      </div>
      <div class="row-fluid">
        <div class="field span6">
          <input class="input-xlarge" type="text" data-ng-model="instance.placeOfManufacture.label" />
          <label>{{ "Tryckland" }}</label>
        </div>
        <div class="field span6">
          <input class="input-xlarge" type="text" data-ng-model="record.about.instanceOf.country" />
          <label>{{ "Utgivningsland" }}</label><!--instance?-->
        </div>
      </div>

      <h3>{{ "Fysisk beskrivning" }}</h3>
      <div class="row-fluid">
        <div class="field span3">
          <input class="input-small" type="text" data-ng-model="instance.extent" />
          <label>{{ "Omfång" }}</label>
        </div>
        <div class="field span3">
          <input class="input-small" type="text" data-ng-model="instance.dimensions" />
          <label>{{ "Mått" }}</label>
        </div>
        <div class="field span3">
          <input class="input-small" type="text" data-ng-model="instance.baseMaterial" />
          <label>{{ "Basmaterial" }}</label>
        </div>
        <div class="field span3">
          <input class="input-small" type="text" data-ng-model="instance.termsOfAvailability" />
          <label>{{ "Pris" }}</label>
        </div>
      </div>

      <h3>{{ "Anmärkning" }}</h3>
      <div class="row-fluid">
        <div class="field span12">
          <input class="input-xxlarge" type="text" data-ng-model="instance.comment" />
          <label>{{ "Anmärkning" }}</label>
        </div>
      </div>
      <div class="row-fluid">
        <div class="field span12">
          <input class="input-xxlarge" type="text" data-ng-model="instance.supplementaryContentNote" />
          <label>{{ "Anmärkning bibliografi etc." }}</label>
        </div>
      </div>
      <div class="row-fluid">
        <div class="field span6">
          <textarea class="input-xxlarge" rows="5" data-ng-model="instance.listOfContents"></textarea>
          <label>{{ "Formaterad innehållsförteckning" }}</label>
        </div>
        <div class="field span6">
          <textarea class="input-xxlarge" rows="5" data-ng-model="instance.summary"></textarea>
          <label>{{ "Sammanfattning" }}</label>
        </div>
      </div>
      <input type='button' id='btn2' value='Spara utkast' data-ng-click="save_draft()"/>
      <input type='button' id='btn3' value='Spara' data-ng-click="save()"/>
      <p class="flash_message"></p>
    </section>
  </article>

    <h2>BESTÅND</h2>
    <article class="well">
      <section>
        <input type='button' value='+' class="btn btn-mini" data-ng-click="add_holding(holdings)"/>
        <ul>
          <li data-ng-repeat="holding in holdings| filter:{location:user_sigel}">
          <input class="input-large" data-ng-model="holding.shelvingControlNumber"/>
          <label>shelvingControlNumber</label>
          <input type='button' id='btn3' value='Spara' data-ng-click="save_holding(holding)"/>
          <input type='button' id='btn3' value='Ta Bort' data-ng-click="delete_holding($index)"/>
          </li>
        </ul>
      </section>
    </article>

    <article class="well">
      <section>
        <btn class="btn btn-primary"> Lägg till bestånd för [mitt sigel]
        <input class="input-large" placeholder="hyllsignum"/>
        <input class="input-large" placeholder="Löpnummer"/>
        <input class="input-large" placeholder="Uppställningsord"/>   
        </btn>
      </section>

      <section class="classification-suggest well">
        <h3>{{ "Förslag på signum" }}</h3>
        <ul class="unstyled inline">
          <li data-ng-repeat="holding in holdings" data-ng-show="holding.classificationPart"><btn class="btn btn-small" ><i class="icon-tag"></i> {{ holding.classificationPart }}</btn></li>
        </ul>
      </section>

      <label data-ng-hide="togglesigels" for="toggle-sigels">Visa alla beståndsposter</label>
      <label data-ng-show="togglesigels" for="toggle-sigels">Visa bara mina beståndsposter</label>
      <input type="checkbox" name="toggle-sigels" ng-model="togglesigels"/>

      <section data-ng-show="togglesigels" id="holdings" data-ng-repeat="holding in holdings.list">
        <div data-ng-include="'render-holding'">
        </div>
      </section>

      <section data-ng-hide="togglesigels" id="holdings" data-ng-repeat="holding in holdings.list | filter:{location:user_sigel}">
        <div data-ng-include="'render-holding'">
        </div>
      </section>
    </article>

</form>

<script type="text/ng-template" id="render-holding">
<div data-ng-show="holding.location">
  <h3><a href="{{ holding['@id'] }}">{{ holding.location }}</a> <span class="muted"> - [biblioteksnamn]</span></h3>
  <ul class="unstyled inline">
    <li data-ng-show="holding.classificationPart">{{ holding.classificationPart }}</li>
    <li data-ng-show="holding.shelvingLocation">{{ holding.shelvingLocation }}</li>
    <li data-ng-show="holding.shelvingFormOrTitle">{{ holding.shelvingFormOrTitle }}</li>
    <li data-ng-show="holding.shelvingControlNumber">{{ holding.shelvingControlNumber }}</li>
  </ul>
  <hr>
</div>
</script>

<script type="text/html" id="auth-completion-template">
<div class="auth">
  <h4>
    <span class="name"><%= data['authoritativeName'] %></span>
    <span class="date"><%= data['birthYear'] %> - <%= data['deathYear'] %></span>
    <% if (data['authorized']) { %>
      <span class="label label-success pull-right"><i class="icon-ok icon-white"></i>Aukt.</span>
    <% } %>
    <% if (data['hasAnnotation'] && data['hasAnnotation']['about']) { %>
      <ul class="about">
        <% data['hasAnnotation']['about'].forEach(function(item) { %>
          <li><%= item %></li>
        <% }) %>
      </ul>
    <% } %>
  </h4>
</div>
</script>

