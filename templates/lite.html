{% extends "base.html" %}

{% block content_class %}record{% endblock content_class %}

{% block content %}
  <h2>Bib Lite</h2>
  <hr>
  {% raw %}
  <div id="litebox" data-ng-app xmlns:ng="http://angularjs.org">
    <form id="fields-lite" class="form-horizontal" data-ng-controller="RecordCtrl">
      <div class="control-group leader">
        <h3 class="field-label">000 -
          {{ map['000'].label_sv }}<button type="button" class="btn btn-mini btn-link"
            data-toggle="collapse" data-target="#hidden-control-fields">
            <i class="icon-edit"></i></button>
        </h3>
        <div id="hidden-control-fields" class="collapse out">
          <div data-ng-repeat="controlField in [leader]"
               data-ng-include="'render-control-field'"></div>
        </div>

        <div data-ng-repeat="field in struct.fields">
          <div data-ng-init="tag = getKey(field); row = field[tag]; dfn = map[tag]">
            <h3 class="field-label">{{ tag }} - {{ dfn.label_sv }}</h3>
            <button data-TODO-if="!dfn || dfn.repeatable"
              class="close pull-right pull-up" data-dismiss="alert">&times;</button>
            <div class="subfield-container" data-ng-switch="widgetType(tag, row)">
                <div data-ng-switch-when="fixedfield"
                    data-ng-init="controlField = parseFixedField(tag, row, dfn)"
                    data-ng-include="'render-control-field'"></div>
                <div data-ng-switch-when="field"
                    data-ng-include="'render-field'"></div>
                <input data-ng-switch-default
                    name="{{ tag }}" data-ng-model="field[tag]"/>
            </div>
          </div>
        </div>

      </div>

    <script type="text/ng-template" id="render-control-field">
      <div data-ng-repeat="(propRef, col) in controlField"
          data-ng-init="propEnum = map.fixprops[propRef]"
          class="control-group fields">
        <label class="control-label">{{ col.getDfn().label_sv }}</label>
        <div class="controls" data-ng-switch="typeOf(propEnum)">
          <select data-ng-switch-when="object" name="{{ propRef }}" class="span7">
            <option data-ng-repeat="(key, val) in propEnum"
                data-ng-selected="key == col.code"
                data-ng-model="key">{{ val.label_sv }}</option>
          </select>
          <input data-ng-switch-default name="{{ propRef }}" data-ng-model="col.code" />
        </div>
      </div>
    </script>

    <script type="text/ng-template" id="render-field">

      <div class="indicators-lite">
        <div data-ng-repeat="indKey in ['ind1', 'ind2']"
            data-ng-init="indEnum = dfn[indKey]; indVal = row[indKey];
                          indType = indicatorType(indEnum)">
          <label data-ng-show="indType != 'hidden'">{{ indKey }}</label>
          <ng:switch on="indType">
            <input data-ng-switch-when="hidden"
                type="hidden" name="{{ tag }}-{{ indKey }}" value="_"/>
            <select data-ng-switch-when="select" name="{{ tag }}-{{ indKey }}">
              <option data-ng-repeat="(key, val) in indEnum"
                  data-ng-selected="key == indVal"
                  data-ng-model="key">{{ val.label_sv }}</option>
            </select>
            <input data-ng-switch-default
                name="{{ tag }}-{{ indKey }}" data-ng-model="row[indKey]"/>
          </ng:switch>
        </div>
      </div>
      <hr />

      <ul data-ng-repeat="subfield in row.subfields">
        <li data-ng-init="subCode = getKey(subfield); subDfn = dfn.subfield[subCode]"
            class="add-on subfield-code input-append">
          <button class="close" data-dismiss="alert">&times;</button>
            <span class="add-on subfield-code">
              {{ subCode }}){{ subDfn.mandatory && '*' || '' }}
              {{ subDfn.label_sv }}
            </span><br />
            <input type="text" class="input-xxlarge"
                name="{{ tag }}-{{ subCode }}" data-ng-model="subfield[subCode]" />
            <button data-ng-show="!subDfn || subDfn.repeatable"
              class="btn btn-medium"
              title="Add"><i class="icon-plus icon-white"></i></button>
        </li>
      </ul>

    </script>

  </div>
  {% endraw %}
{% endblock content %}

{% block extrajs %}

  <script src="{{ url_for('static', filename='vendor/angular.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/marcjson.js') }}"></script>

{% endblock extrajs %}
